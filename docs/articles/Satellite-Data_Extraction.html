<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Satellite data extraction workflow • RSSApkg</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">RSSApkg</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/extractR.html">Extract satellite data for feature locations</a>
    </li>
    <li>
      <a href="../articles/jpegR.html">Create quality assessment jpegs</a>
    </li>
    <li>
      <a href="../articles/Satellite-Data_Extraction.html">Satellite data extraction workflow</a>
    </li>
    <li>
      <a href="../articles/Using%20the%20RSSApkg.html">Using the RSSApkg</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RSPaW/RSSApkg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Satellite data extraction workflow</h1>
                        <h4 class="author">Bart Huntley</h4>
            
            <h4 class="date">2017-06-29</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>One of the challenges in remote sensing and working with satellite imagery is how to deal with clouds and shadows. There are various automated routines that exist to aid the researcher such as:</p>
<ul>
<li>Using a cloud filter option when downloading the imagery in the first instance.</li>
<li>Using an automated cloud masking algorithm such as <strong>fmask</strong> as used by the USGS.</li>
</ul>
<p>Although these tools are very useful they can be a bit “blunt” as an instrument.</p>
<p>One of the benefits of the explosion of availability of satellite data is that dense temporal analysis can now be performed. Phenological cycles can now be modeled and monitored, for example, and using every suitable image adds more certainty to the analysis. In regions where cloud cover often interferes with data availability it makes sense to be very accurate with with cloud quality assessment.</p>
<p>This workflow has been designed around a “per site” cloud quality assessment protocol. This means that even if an image has been deemed 90% cloud cover, through automated assessment by imagery providers, it still may yield usable data over a site. This method also allows for a more precise identification of:</p>
<ul>
<li>Very thin haze associated with smoke.</li>
<li>Cloud shadows.</li>
<li>Clouds in bright environment.</li>
</ul>
<p>Essentially it consists of the following 3 stages which will yield quality assessed time series data for further analysis.</p>
<p><strong>Stage 1.</strong> The creation of small jpeg images for each site and date of locally stored satellite data.</p>
<p><strong>Stage 2.</strong> Rapid visual assessment of created jpegs with deletion of unsuitable images.</p>
<p><strong>Stage 3.</strong> Extraction of data per site for the dates of images that are left after stage 2.</p>
</div>
<div id="stage-1" class="section level2">
<h2 class="hasAnchor">
<a href="#stage-1" class="anchor"></a>Stage 1</h2>
<p>Firstly start by creating a working directory. This must contain a shape file of the sites or locations that ultimately require “clean” data. This directory will become the repository of all the data that is generated through this workflow.</p>
<p>Next task is to run the <code>jpegR</code> function from the <strong>RSSApkg</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Install the RSSApkg if you haven't already
<span class="kw">library</span>(<span class="st">"devtools"</span>)
<span class="kw">install_github</span>(<span class="st">"Bartesto/RSSApkg"</span>)
<span class="kw">library</span>(<span class="st">"RSSApkg"</span>)

## Set up function arguments
<span class="co"># wdir &lt;- path/to/working directory</span>
<span class="co"># imdir &lt;- path/to/imagery directory/pathrow</span>
<span class="co"># layer &lt;- name of shape file that has locations of interest</span>
<span class="co"># attrb &lt;- name of unique id field in shape file</span>
<span class="co"># start &lt;- start image search from this date</span>
<span class="co"># stop &lt;- end image search on this date</span>
<span class="co"># combo &lt;- band numbers to display in RGB</span>
<span class="co"># buffer &lt;- how far to buffer the site location (in metres if imagery is projected to GDA94)</span>

## Run the function
<span class="kw"><a href="../reference/jpegR.html">jpegR</a></span>(wdir, imdir, <span class="dt">layer =</span> <span class="st">"my_shape_file"</span>, <span class="dt">attrb =</span> <span class="st">"siteID"</span>, <span class="dt">start =</span> <span class="st">"01/12/99"</span>, 
      <span class="dt">stop =</span> <span class="st">"31-12-2002"</span>, <span class="dt">combo =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">2</span>), <span class="dt">buffer =</span> <span class="dv">2000</span>)</code></pre></div>
<p>Things to note about the function arguments:</p>
<ul>
<li>
<strong>wdir</strong> and <strong>imdir</strong> are file paths and need to be character strings.</li>
<li>
<strong>layer</strong> is a character string of the shape file name without the .shp extension.</li>
<li>
<strong>attrb</strong> is the field name of the attribute table that stores the unique ID for the locations in the shape file. It is a character string.</li>
<li>
<strong>start</strong> and <strong>end</strong> are character strings of dates in either ddmmyy or ddmmY format. It will handle either separator. If you do not provide dates it will search the whole archive. Use these date fields to target your search or to do annual updates and avoid re-processing the entire archive.</li>
<li>
<strong>combo</strong> are the bands that will be displayed in the red, green and blue channels of the jpeg respectively. In this instance a false colour 542 jpeg will be created. Must be a vector of numbers presented this way.</li>
<li>
<strong>buffer</strong> for GDA94 projected images the numbers represent meters for the buffer.</li>
</ul>
<p>The above example would produce jpeg images for each unique location (as designated by id’s found in the ’siteID“” column of the attribute table) in a shape file called “my_shape_file”, for all available satellite data between the dates 01/02/1999 - 31/12/2002. These jpegs would be buffered from the location by 2km and would be a false colour enhancement (542).</p>
<p>For each location a folder will be created in the working directory containing all the jpegs. The folders will be named after the unique locations and will have the naming convention <code>jpegs_site_XXX_bbbbbb_eeeeee</code> where:</p>
<ul>
<li>
<strong>XXX</strong> is the unique location id.</li>
<li>
<strong>bbbbbb</strong> is the first date of imagery processed.</li>
<li>
<strong>eeeeee</strong> is the last date of imagery processed.</li>
</ul>
<p>During the process it will also create another folder called <code>site_vectors</code>. At the beginning of the function call, the original shape file contained in the working directory will be split into separate shape files based on the unique locations. These will be stored in this folder along with a small .txt file that contains the name of the original shape file.</p>
</div>
<div id="stage-2" class="section level2">
<h2 class="hasAnchor">
<a href="#stage-2" class="anchor"></a>Stage 2</h2>
<p>Now that the jpegs are created it’s time for a visual assessment. This is not as time consuming or onerous as it sounds. A technique that’s quick is to open up the folder and view the jpegs as “extra large icons”. Then simply delete from the folder any that don’t meet your criteria. The human eye is great at pattern recognition and as soon as the observer becomes familiar with the location, artifacts such as cloud, smoke or haze become easy to spot. Some example images are shown below:</p>
<div class="figure">
<img src="cloud.jpg" alt="A cloud affected site displayed in false colour 542"><p class="caption"><strong>A cloud affected site displayed in false colour 542</strong></p>
</div>
<div class="figure">
<img src="nocloud.jpg" alt="A non-cloud affected site displayed in false colour 542"><p class="caption"><strong>A non-cloud affected site displayed in false colour 542</strong></p>
</div>
<p>Not all clouds will be as easy to spot as this example and sometimes shadow can be hard to discern. What can help is re-running <code>jpegR</code> with a larger <strong>buffer</strong>. This has the effect of “zooming out” and sometimes a broader context can help. The default 2000 is a good starting point.</p>
<p>All the jpegs are named after the date of satellite data that they were created from. By deleting the “bad” jpegs it leaves a folder full of quality assessed dates that will be used in the next stage when values are extracted for each location.</p>
<p>As mentioned the process is quick and an assessor should be able to “QA” as fast as the images are produced.</p>
</div>
<div id="stage-3" class="section level2">
<h2 class="hasAnchor">
<a href="#stage-3" class="anchor"></a>Stage 3</h2>
<p>This last stage entails running the <code>extractR</code> function from the <strong>RSSApkg</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Set up function arguments
<span class="co"># wdir &lt;- path/to/working directory</span>
<span class="co"># imdir &lt;- path/to/imagery directory/pathrow</span>
<span class="co"># option &lt;- band or vegetation index to extract</span>
<span class="co"># attrb &lt;- name of unique id field in shape file</span>

<span class="kw"><a href="../reference/extractR.html">extractR</a></span>(wdir, imdir, <span class="dt">option =</span> <span class="st">"i35"</span>, <span class="dt">attrb =</span> <span class="st">"siteID"</span>)</code></pre></div>
<p>Things to note about the function arguments:</p>
<ul>
<li>
<strong>wdir</strong> and <strong>imdir</strong> are file paths and need to be character strings.</li>
<li>
<strong>option</strong> is a character string of <strong>one of</strong> the following choices. “i35”, “ndvi”, “b1”, “b2”, “b3”, “b4”, “b5” or “b6”. the first 2 are vegetation indices whilst the remaining choices refer to individual bands. Individual band extraction provides the flexibility of producing other indices or band combinations. It must be a character string.</li>
<li>
<strong>attrb</strong> is the field name of the attribute table that stores the unique ID for the locations in the shape file. It is a character string.</li>
</ul>
<p>The above example would produce a .csv file containing i35 values for all of the unique locations in the working directory. This file would have the following format. Note NA’s are the results of the quality assessment process removing a particular image date.</p>
<table class="table">
<thead><tr class="header">
<th align="center">..</th>
<th align="center">date</th>
<th align="center">site1</th>
<th align="center">site2</th>
<th align="center">etc</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">10/03/1999</td>
<td align="center">73.11526</td>
<td align="center">NA</td>
<td align="center">etc</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">26/03/1999</td>
<td align="center">37.10274</td>
<td align="center">35.19674</td>
<td align="center">etc</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">14/06/1999</td>
<td align="center">NA</td>
<td align="center">44.44317</td>
<td align="center">etc</td>
</tr>
</tbody>
</table>
<p>This file will have the following naming convention <code>ppprrr_option_QA_bbbbbb-eeeeee.csv</code> where:</p>
<ul>
<li>
<strong>ppprrr</strong> is the path/row (6 digits) of the Landsat scene.</li>
<li>
<strong>option</strong> is what was extracted.</li>
<li>
<strong>bbbbbb</strong> is the first date of extracted value/s.</li>
<li>
<strong>eeeeee</strong> is the last date of extracted value/s.</li>
</ul>
<p>It will also create a separate .csv file per location and store it in the appropriate jpeg folder. These files are formatted slightly differently.</p>
<table class="table">
<thead><tr class="header">
<th align="center">date</th>
<th align="center">site1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">10/03/1999</td>
<td align="center">73.11526</td>
</tr>
<tr class="even">
<td align="center">26/03/1999</td>
<td align="center">37.10274</td>
</tr>
<tr class="odd">
<td align="center">etc</td>
<td align="center">etc</td>
</tr>
</tbody>
</table>
<p>These files will have the following naming conventions <code>ppprrr_option_XXX_bbbbbb-eeeeee.csv</code> where:</p>
<ul>
<li>
<strong>ppprrr</strong> is the path/row (6 digits) of the Landsat scene.</li>
<li>
<strong>option</strong> is what was extracted.</li>
<li>
<strong>XXX</strong> is the unique location id.</li>
<li>
<strong>bbbbbb</strong> is the first date of extracted value/s.</li>
<li>
<strong>eeeeee</strong> is the last date of extracted value/s.</li>
</ul>
<p><strong>NOTE</strong> that re-running <code>extractR</code> with the same function arguments will write over the previous output if there have been no new satellite images added to the local archive.</p>
<p>As part of the process, a copy of the unique location shape files, are saved to each of the appropriate jpeg folders. This keeps all of the associated files together for each location.</p>
</div>
<div id="updating-data-sets" class="section level2">
<h2 class="hasAnchor">
<a href="#updating-data-sets" class="anchor"></a>Updating data sets</h2>
<p>It is anticipated that updating the extracted values will be required as new satellite imagery is downloaded and processed (e.g. annual updates). This should be a straight forward process whereby:</p>
<ul>
<li>A new working directory is created and the original shape file is copied into it.</li>
<li>The 3 stages above are followed again but this time restricting <code>jpegR</code> to only the newly acquired image dates.</li>
</ul>
<p>Any .csv outputs from this update should then be added onto the original outputs.</p>
</div>
<div id="need-help" class="section level2">
<h2 class="hasAnchor">
<a href="#need-help" class="anchor"></a>Need help?</h2>
<p>There is a separate vignette for <code>jpegR</code> and <code>extractR</code> which explain some of the finer details. There is also a separate help file written for all functions in the <strong>RSSApkg</strong> found through the RStudio R Help tab and through the usual R methods if you are not working in RStudio.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#stage-1">Stage 1</a></li>
      <li><a href="#stage-2">Stage 2</a></li>
      <li><a href="#stage-3">Stage 3</a></li>
      <li><a href="#updating-data-sets">Updating data sets</a></li>
      <li><a href="#need-help">Need help?</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Bart Huntley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
